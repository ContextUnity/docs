---
title: ContextWorker
description: Background Processing Engine for ContextUnity
template: splash
hero:
  tagline: The "Hands" of the ContextUnity ecosystem — durable workflows, scheduled jobs, and background agents powered by Temporal.
  image:
    file: ../../assets/worker-image.jpg
    alt: ContextWorker - The Execution Layer
  actions:
    - text: Get Started
      link: /getting-started/
      icon: right-arrow
      variant: primary
    - text: View on GitHub
      link: https://github.com/ContextUnity/contextworker
      icon: external
---

import { Card, CardGrid, LinkCard } from '@astrojs/starlight/components';

<CardGrid>
  <Card title="Temporal Workflows" icon="rocket">
    Durable workflow execution that survives restarts and failures. Automatic retries, timeouts, and state management for complex job pipelines.
  </Card>
  <Card title="Agent Registry" icon="puzzle">
    `@register` decorator pattern for background agents. Polling loops, lifecycle management, automatic discovery.
  </Card>
  <Card title="gRPC Service" icon="setting">
    WorkerService exposes workflow triggers via gRPC using ContextUnit protocol. Type-safe inter-service communication.
  </Card>
  <Card title="Schedule Management" icon="approve-check">
    Native Temporal scheduling with CLI tools. Create, pause, trigger, and manage recurring jobs.
  </Card>
</CardGrid>

## Architecture

```
┌─────────────────────────────────────────────────────────────────────┐
│                         ContextRouter                               │
│                     (The "Mind" — Orchestration)                    │
├─────────────────────────────────────────────────────────────────────┤
│  • Orchestrates AI agents (Gardener, Matcher)                       │
│  • Calls Worker to trigger workflows                                │
└───────────────────────────────────────┬─────────────────────────────┘
                                        │ triggers via gRPC
                                        ▼
┌─────────────────────────────────────────────────────────────────────┐
│                         ContextWorker                               │
│                     (The "Hands" — Execution)                       │
├─────────────────────────────────────────────────────────────────────┤
│  ├── registry.py       ← Agent registry (@register)                │
│  ├── service.py        ← gRPC WorkerService                        │
│  ├── schedules.py      ← Temporal schedule management              │
│  └── agents/           ← Background polling agents                 │
└───────────────────────────────────────┬─────────────────────────────┘
                                        │ runs workflows defined in
                                        ▼
┌─────────────────────────────────────────────────────────────────────┐
│                        ContextCommerce                              │
│                    (The "Store" — Domain Logic)                     │
├─────────────────────────────────────────────────────────────────────┤
│  • Defines harvester workflows/activities                           │
│  • Product catalog and taxonomy                                     │
└─────────────────────────────────────────────────────────────────────┘
```

Worker is **pure infrastructure**. All business logic lives in domain packages.

## Quick Start

```bash
# Install (with Commerce modules)
pip install contextcommerce  # Includes contextworker

# Run all agents
python -m contextworker

# Run specific agents
python -m contextworker --agents gardener harvester

# Create schedules
python -m contextworker.schedules create --tenant-id myproject

# List schedules
python -m contextworker.schedules list
```

## Quick Links

<CardGrid>
  <LinkCard title="Getting Started" href="/getting-started/" description="Installation and first steps." />
  <LinkCard title="Temporal Workflows" href="/guides/workflows/" description="Durable workflow patterns." />
  <LinkCard title="gRPC Integration" href="/guides/grpc/" description="Service-to-service communication." />
  <LinkCard title="CLI Reference" href="/reference/cli/" description="Command-line tools." />
</CardGrid>

<CardGrid>
  <LinkCard title="Background Agents" href="/guides/agents/" description="Polling agents with registry." />
  <LinkCard title="Schedules" href="/guides/schedules/" description="Manage recurring jobs." />
  <LinkCard title="Harvester" href="/guides/harvester/" description="Data import workflows." />
  <LinkCard title="Gardener" href="/guides/gardener/" description="AI enrichment integration." />
</CardGrid>

## Core Components

### Agent Registry

Background agents register via decorator:

```python
from contextworker.registry import register, BaseAgent

@register("myagent")
class MyAgent(BaseAgent):
    name = "myagent"
    
    async def run(self):
        while self._running:
            items = await self.poll_for_work()
            await asyncio.sleep(60)
```

### gRPC Service

WorkerService exposes workflow triggers:

```python
# Trigger workflow via ContextUnit
unit = ContextUnit(
    payload={
        "workflow_type": "harvest",
        "supplier_code": "camping-trade",
    },
    provenance=["commerce:api"],
)
```

### Schedule Management

```bash
# Create default schedules
python -m contextworker.schedules create --tenant-id myproject

# Pause/trigger schedules
python -m contextworker.schedules pause gardener-every-5min
python -m contextworker.schedules trigger harvest-camping-trade
```

## Built-in Agents

| Agent | Purpose | Poll Interval |
|-------|---------|---------------|
| `gardener` | Enrich pending products | 5 min |
| `harvester` | Trigger supplier imports | 1 hour |
| `lexicon` | Sync terminology | 15 min |

## Docker Compose

```yaml
services:
  temporal:
    image: temporalio/auto-setup:latest
    ports:
      - "7233:7233"
      - "8080:8080"  # Temporal UI

  worker:
    image: contextcommerce:latest
    command: python -m contextworker
    environment:
      - TEMPORAL_HOST=temporal:7233
      - DATABASE_URL=postgres://...
    deploy:
      replicas: 3  # Scale workers independently
```

---

## Configuration

```bash
# Temporal
TEMPORAL_HOST=localhost:7233
WORKER_TASK_QUEUE=default

# Database (for activities accessing Commerce)
DATABASE_URL=postgresql://user:pass@localhost/commerce

# Tenant
TENANT_ID=myproject
```
