---
title: BrainClient SDK
description: Python SDK for interacting with ContextBrain service
---

# BrainClient SDK

BrainClient is the Python SDK for interacting with ContextBrain. It supports both gRPC and local modes for maximum flexibility.

## Installation

BrainClient is included in the `contextcore` package:

```bash
pip install contextcore
# or with uv
uv add contextcore
```

## Quick Start

```python
from contextcore import BrainClient

# Default: uses CONTEXT_BRAIN_URL and CONTEXT_BRAIN_MODE from environment
client = BrainClient()

# Explicit configuration
client = BrainClient(host="localhost:50051", mode="grpc")
```

## Modes

### gRPC Mode (Default)

Connects to Brain gRPC server over the network:

```python
client = BrainClient(mode="grpc", host="brain.example.com:50051")
```

**Environment variables:**
```bash
CONTEXT_BRAIN_MODE=grpc
CONTEXT_BRAIN_URL=localhost:50051
```

### Local Mode

Direct library calls without network overhead. Ideal for development:

```python
client = BrainClient(mode="local")
```

**Environment:**
```bash
CONTEXT_BRAIN_MODE=local
```

:::note
Local mode requires the `contextbrain` package to be installed and a valid `BRAIN_DATABASE_URL`.
:::

## Knowledge Operations

### Search

Semantic search across stored knowledge:

```python
results = await client.search(
    tenant_id="traverse",
    query_text="winter jacket waterproof",
    limit=10,
    source_types=["product", "document"],  # Optional filter
)

for result in results:
    print(f"{result.score:.2f}: {result.content[:100]}")
    print(f"  Metadata: {result.metadata}")
```

**SearchResult fields:**
- `id`: Unique identifier
- `content`: Stored content text
- `score`: Similarity score (0-1)
- `source_type`: Type of source
- `metadata`: Additional metadata dict

### Upsert

Store new content with embeddings:

```python
doc_id = await client.upsert(
    tenant_id="traverse",
    content="Nike Winter Jacket - Waterproof, insulated, breathable",
    source_type="product",
    metadata={
        "sku": "NIKE-WJ-001",
        "brand": "Nike",
        "category": "clothing.jackets.winter",
    },
)

print(f"Stored with ID: {doc_id}")
```

### Create Knowledge Graph Relation

Link entities in the knowledge graph:

```python
success = await client.create_kg_relation(
    tenant_id="traverse",
    source_type="product",
    source_id="12345",
    relation="MADE_BY",
    target_type="brand",
    target_id="nike",
)
```

## Commerce Operations

### Get Products

Fetch products for enrichment:

```python
products = await client.get_products(
    tenant_id="traverse",
    product_ids=[1, 2, 3, 4, 5],
)

for product in products:
    print(f"{product['name']} - {product['brand_name']}")
```

### Update Enrichment

Update product enrichment data:

```python
success = await client.update_enrichment(
    tenant_id="traverse",
    product_id=12345,
    enrichment={
        "taxonomy": "clothing.jackets.winter",
        "attributes": {
            "color": "black",
            "size": "XL",
            "gender": "men",
        },
    },
    trace_id="gardener-run-123",
    status="enriched",
)
```

### Upsert Dealer Product

Store raw supplier product:

```python
product_id = await client.upsert_dealer_product(
    tenant_id="traverse",
    dealer_code="VYSOTA",
    dealer_name="Vysota Sport",
    sku="WJ-001",
    name="Winter Jacket Nike",
    category="Одяг > Куртки",
    brand_name="Nike",
    quantity=10,
    price_retail=1500.00,
    currency="UAH",
    params={"color": "black", "size": "XL"},
    status="raw",
)
```

## News Operations

For PinkPony and news pipelines:

```python
# Check if news post exists (deduplication)
exists = await client.check_news_post_exists(
    tenant_id="pinkpony",
    url="https://example.com/article",
)

# Upsert news post
post_id = await client.upsert_news_post(
    tenant_id="pinkpony",
    url="https://example.com/article",
    title="Breaking News",
    content="Full article content...",
    source="Reuters",
    published_at=datetime.now(),
)
```

## Error Handling

```python
from contextcore import BrainClientError

try:
    results = await client.search(tenant_id="test", query_text="...")
except BrainClientError as e:
    print(f"Brain error: {e.code} - {e.message}")
except ConnectionError:
    print("Cannot connect to Brain service")
```

## Async/Sync Bridge

For synchronous code (e.g., Django views, LangGraph nodes):

```python
from asgiref.sync import async_to_sync

def sync_search(query: str):
    async def _search():
        client = BrainClient()
        return await client.search(
            tenant_id="default",
            query_text=query,
        )
    
    return async_to_sync(_search)()
```

## Configuration Reference

| Environment Variable | Default | Description |
|---------------------|---------|-------------|
| `CONTEXT_BRAIN_MODE` | `grpc` | Client mode: `grpc` or `local` |
| `CONTEXT_BRAIN_URL` | `localhost:50051` | Brain gRPC server address |
| `BRAIN_DATABASE_URL` | - | PostgreSQL connection (local mode) |
| `BRAIN_SCHEMA` | `brain` | PostgreSQL schema (local mode) |

## Type Definitions

```python
from dataclasses import dataclass

@dataclass
class SearchResult:
    id: str
    content: str
    score: float
    source_type: str
    metadata: dict
```

## See Also

- [Multi-Service Architecture](/guides/multi-service/)
- [ContextUnit Protocol](/contextunit/protocol/)
- [Temporal Integration](/guides/temporal/)
